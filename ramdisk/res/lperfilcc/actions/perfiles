#!/sbin/busybox sh

if [[ ! -z $2 ]]; then
    filename=$(basename $2)
fi

if [[ ! -z $3 ]]; then
  evalcmd='eval "$filename=$3"'
  eval $evalcmd
fi

perfil_predef="0"
perfil_find=`grep "perfil_predef" $DEFAULT_PROFILE | cut -d'=' -f2`

write_value() {  
  echo "$1=$2" >> $DEFAULT_PROFILE
}

edit_value() {
  g_find=`grep $1=.* $DEFAULT_PROFILE`
    
  if [[ -z $g_find ]]; then
    write_value $1 $2
  else
    sed -i "s/$1=[^ ]*/$1=$2/" $DEFAULT_PROFILE 
  fi
}

write_values(){
  edit_value GPU_volt_table $GPU_volt_table
  edit_value mif_volt_table $mif_volt_table
  edit_value int_volt_table $int_volt_table
  edit_value UV_uV_table $UV_uV_table
  edit_value perfil_predef $perfil_predef 

  echo $GPU_volt_table >/sys/class/misc/gpu_control/gpu_voltage_control
  echo $mif_volt_table >/sys/devices/system/cpu/busfreq/LP_mif_volt_table
  echo $int_volt_table >/sys/devices/system/cpu/busfreq/LP_int_volt_table
  echo $UV_uV_table >/sys/devices/system/cpu/cpu0/cpufreq/LP_uV_table
}
case "$perfilpredef" in
  0)
    # Perfil Stock (0)
    GPU_volt_table="875000 900000 950000 1025000 1075000"
    mif_volt_table="900000 900000 900000 950000 950000 1050000 1050000"
    int_volt_table="862500 900000 925000 925000 1012500 1012500 1062500"
    UV_uV_table="1387500 1337500 1300000 1250000 1200000 1150000 1100000 1050000 1000000 975000 962500 950000 950000 925000 900000 887500"
    perfil_predef="0"
    write_values
    ;;
  1)
    # Perfil Normal (1)
    GPU_volt_table="850000 875000 925000 1000000 1050000"
    mif_volt_table="875000 875000 875000 925000 925000 1025000 1025000"
    int_volt_table="837500 875000 900000 900000 987500 987500 1037500"
    UV_uV_table="1362500 1312500 1275000 1225000 1175000 1125000 1075000 1025000 975000 950000 937500 925000 925000 900000 875000 862500"
    perfil_predef="1"
    write_values
    ;;
  2)
    # Perfil Medio (2)
    GPU_volt_table="850000 875000 925000 1000000 1050000"
    mif_volt_table="875000 875000 875000 925000 925000 1025000 1025000"
    int_volt_table="837500 875000 900000 900000 987500 987500 1037500"
    UV_uV_table="1337500 1287500 1250000 1200000 1150000 1100000 1050000 1000000 950000 925000 912500 900000 900000 875000 850000 837500"
    perfil_predef="2"
    write_values
    ;;
  3)
    # Perfil Extremo (3)
    GPU_volt_table="825000 850000 900000 975000 1025000"
    mif_volt_table="875000 875000 875000 925000 925000 1025000 1025000"
    int_volt_table="837500 875000 900000 900000 987500 987500 1037500"
    UV_uV_table="1312500 1262500 1225000 1175000 1125000 1075000 1025000 975000 925000 900000 887500 875000 875000 850000 825000 812500"
    perfil_predef="3"
    write_values
    ;;
  4)
    # Perfil MÃ¡ximo (4)
    GPU_volt_table="825000 850000 900000 975000 1025000"
    mif_volt_table="875000 875000 875000 925000 925000 1025000 1025000"
    int_volt_table="837500 875000 900000 900000 987500 987500 1037500"
    UV_uV_table="1287500 1237500 1200000 1150000 1100000 1050000 1000000 950000 900000 875000 862500 850000 850000 825000 800000 787500"
    perfil_predef="4"
    write_values
    ;;
  5)
    # Perfil Supremo (5)
    GPU_volt_table="800000 825000 875000 950000 1000000"
    mif_volt_table="850000 850000 850000 900000 900000 1000000 1000000"
    int_volt_table="812500 850000 875000 875000 962500 962500 1012500"
    UV_uV_table="1287500 1237500 1200000 1150000 1100000 1050000 1000000 950000 900000 875000 862500 850000 850000 825000 800000 787500"
    perfil_predef="5"
    write_values
    ;;
  6)
    # Perfil Megavolt (6)
    GPU_volt_table="800000 825000 875000 950000 1000000"
    mif_volt_table="825000 825000 825000 875000 875000 975000 975000"
    int_volt_table="787500 825000 850000 850000 937500 937500 987500"
    UV_uV_table="1287500 1237500 1200000 1150000 1100000 1050000 1000000 950000 900000 875000 862500 850000 850000 825000 800000 787500"
    perfil_predef="6"
    write_values
    ;;

  7)
    # Perfil Demente (7)
    GPU_volt_table="775000 800000 850000 925000 975000"
    mif_volt_table="825000 825000 825000 875000 875000 975000 975000"
    int_volt_table="787500 825000 850000 850000 937500 937500 987500"
    UV_uV_table="1262500 1212500 1175000 1125000 1075000 1025000 975000 925000 875000 850000 837500 825000 825000 800000 775000 762500"
    perfil_predef="7"
    write_values
    ;;
  *)
    if [[ ! -z $perfil_find ]]; then
      perfil_predef="$perfil_find"
    fi 
    ;;
esac;

eval echo $perfil_predef
